---
import i18next, { changeLanguage } from 'i18next'
import SharedSlug from '~/components/SharedSlug.astro'
import ContentLayout from '~/layouts/Content.astro'
import type { ArticleFrontmatter } from '~/types/mdx'

changeLanguage('en')

export async function getStaticPaths() {
    const articles = await Astro.glob<ArticleFrontmatter>(
        `../../content/**/*.mdx`
    )
    const filteredArticles = articles.filter(
        ({ frontmatter }) =>
            frontmatter.language === i18next.language &&
            frontmatter.type === 'article' &&
            !frontmatter.draft
    )
    return filteredArticles.map(({ frontmatter: { slug } }) => ({
        params: { slug },
    }))
}
const articles = await Astro.glob<ArticleFrontmatter>(`../../content/**/*.mdx`)
const filteredArticles = articles.filter(
    ({ frontmatter }) =>
        frontmatter.language === i18next.language &&
        frontmatter.type === 'article' &&
        !frontmatter.draft
)
const article = filteredArticles.find(
    ({ frontmatter }) => frontmatter.slug === Astro.params.slug
)!
const { Content, frontmatter } = article
---

<ContentLayout
    head={{
        title: frontmatter.title,
        description: frontmatter.description,
        image: frontmatter.thumbnail,
        article: {
            section: frontmatter.category,
            tags: frontmatter.tags,
            authors: ['Florian Lefebvre'],
            modifiedTime: frontmatter.modifiedTime,
            publishedTime: frontmatter.publishedTime,
        },
    }}
>
    <SharedSlug
        frontmatter={frontmatter}
        headings={article.getHeadings()}
        Content={Content}
    />
</ContentLayout>
